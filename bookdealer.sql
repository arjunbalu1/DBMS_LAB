CREATE DATABASE BOOK_DATABASE;
USE BOOK_DATABASE;

CREATE TABLE PUBLISHER
(PNAME VARCHAR (20),
PHONE DOUBLE,
ADDRESS VARCHAR (20),
PRIMARY KEY (PNAME));

CREATE TABLE BOOK
(BOOKID INT PRIMARY KEY,
TITLE VARCHAR (20),
PUBYEAR VARCHAR (20),
PUBLISHERNAME VARCHAR(20),
FOREIGN KEY (PUBLISHERNAME) REFERENCES PUBLISHER(PNAME) ON DELETE CASCADE);


CREATE TABLE BOOKAUTHORS
(
BOOKID INT,
AUTHORNAME VARCHAR (20),
FOREIGN KEY (BOOKID) REFERENCES BOOK(BOOKID)ON DELETE CASCADE,
PRIMARY KEY (BOOKID,AUTHORNAME));

CREATE TABLE LIBRARYBRANCH
(BRANCHID INT PRIMARY KEY,
BRANCHNAME VARCHAR(30),
ADDRESS VARCHAR (30));

CREATE TABLE BOOKCOPIES
(NOOFCOPIES INT,
BOOKID INT,
BRANCHID INT,
FOREIGN KEY (BOOKID) REFERENCES BOOK(BOOKID) ON DELETE CASCADE,
FOREIGN KEY (BRANCHID) REFERENCES LIBRARYBRANCH(BRANCHID)ON DELETE CASCADE);

CREATE TABLE BOOKLENDING
(DATE_OUT DATE,
DUE_DATE DATE,
BOOKID INT,
BRANCHID INT,
CARDNO INT,
FOREIGN KEY (BOOKID) REFERENCES BOOK(BOOKID) ON DELETE CASCADE,
FOREIGN KEY (BRANCHID) REFERENCES LIBRARYBRANCH(BRANCHID)ON DELETE CASCADE,
PRIMARY KEY (CARDNO,BOOKID,BRANCHID));

INSERT INTO PUBLISHER VALUES('MCGRAW-HILL',9989876587,'BANGALORE');
INSERT INTO PUBLISHER VALUES('PEARSON',98899876565,'NEW DELHI');
INSERT INTO PUBLISHER VALUES('RANDOM HOUSE',7455679345,'HYDERABAD');
INSERT INTO PUBLISHER VALUES('HACHETTE LIVRE',8970862340,'CHENNAI');
INSERT INTO PUBLISHER VALUES('GRUPO PLANETA',7756120238,'BANGALORE');

INSERT INTO BOOK VALUES (1,'DBMS','JAN-2017', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (2,'ADBMS','JUN-2016', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (3,'CN','SEP-2016', 'PEARSON');
INSERT INTO BOOK VALUES (4,'CG','SEP-2015', 'GRUPO PLANETA');
INSERT INTO BOOK VALUES (5,'OS','MAY-2016', 'PEARSON');

INSERT INTO BOOKAUTHORS VALUES (1,'NAVATHE');
INSERT INTO BOOKAUTHORS VALUES (2,'NAVATHE');
INSERT INTO BOOKAUTHORS VALUES (3,'TANENBAUM');
INSERT INTO BOOKAUTHORS VALUES (4,'EDWARD ANGEL');
INSERT INTO BOOKAUTHORS VALUES (5,'GALVIN');

INSERT INTO LIBRARYBRANCH VALUES (10,'RR NAGAR','BANGALORE');
INSERT INTO LIBRARYBRANCH VALUES (11,'RNSIT','BANGALORE');
INSERT INTO LIBRARYBRANCH VALUES (12,'RAJAJI NAGAR', 'BANGALORE');
INSERT INTO LIBRARYBRANCH VALUES (13,'NITTE','MANGALORE');
INSERT INTO LIBRARYBRANCH VALUES (14,'MANIPAL','UDUPI');

INSERT INTO BOOKCOPIES VALUES (10, 1, 10);
INSERT INTO BOOKCOPIES VALUES (5, 1, 11);
INSERT INTO BOOKCOPIES VALUES (2, 2, 12);
INSERT INTO BOOKCOPIES VALUES (5, 2, 13);
INSERT INTO BOOKCOPIES VALUES (7, 3, 14);
INSERT INTO BOOKCOPIES VALUES (1, 5, 10);
INSERT INTO BOOKCOPIES VALUES (3, 4, 11);

INSERT INTO BOOKLENDING VALUES ('2017-01-01','2017-06-01', 1, 10, 101);
INSERT INTO BOOKLENDING VALUES ('2017-01-11','2017-03-11', 3, 14, 101);
INSERT INTO BOOKLENDING VALUES ('2017-02-21','2017-04-21', 2, 13, 101);
INSERT INTO BOOKLENDING VALUES ('2017-03-15','2017-07-15', 4, 11, 101);
INSERT INTO BOOKLENDING VALUES ('2017-04-12','2017-05-12', 1, 11, 104);


-- Retrieve details of all books in the library â€“ id, title, name of publisher, authors, number of copies in each branch, etc.
SELECT B.BOOKID, B.TITLE, B.PUBLISHERNAME, A.AUTHORNAME,
C.NOOFCOPIES, L.BRANCHID
FROM BOOK B, BOOKAUTHORS A, BOOKCOPIES C, LIBRARYBRANCH L
WHERE B.BOOKID=A.BOOKID
AND B.BOOKID=C.BOOKID
AND L.BRANCHID=C.BRANCHID;

-- Get the particulars of borrowers who have borrowed more than 3 books, but from Jan 2017 to Jun 2017.

SELECT CARDNO
FROM BOOKLENDING 
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-07-01'
GROUP BY CARDNO
HAVING Count(*)>3;

-- Delete a book in BOOK table. Update the contents of other tables to reflect this data manipulation operation.

DELETE FROM BOOK
WHERE BOOKID='3';
SELECT * FROM BOOK;
-- Partition the BOOK table based on year of publication. Demonstrate its working with a simple query.
CREATE VIEW V_PUBLICATION AS
SELECT PUBYEAR
FROM BOOK;
SELECT * FROM V_PUBLICATION;
-- Create a view of all books and its number of copies that are currently available in the Library.

CREATE VIEW V_BOOKS AS
SELECT B.BOOKID, B.TITLE, C.NOOFCOPIES
FROM BOOK B, BOOKCOPIES C, LIBRARYBRANCH L
WHERE B.BOOKID=C.BOOKID
AND C.BRANCHID=L.BRANCHID;
SELECT * FROM V_BOOKS;
